 
;; so what are the things that are known in prior
;; 1. An agent knows the current context it is in.
;; 2. An agent knows the goal it shall achieve. Should involve in some kind of searching mechanism
;; 3. There is a rule space that contains all the necessary cognitive schema. This is expected 
;; to be mined by the pattern miner.
;; 4. Since the agent knows its initial state, it will start 
;; from there and search rules that begins with the initial state.
;; 5. Hence, the agent selects the rule with the best metric.
;; 6. Then it selects the action from the rule and adds it to an accumulator.
;; 7. Then it starts from the goal as a context from the rule that is selected.
!(bind! &ruleSpace (new-space))


(= (addRulesToSpace $space)
    (let $rules ( superpose 
      (
        ((: r1 ((TTV 1 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Conversation-Started 0.9 0.6) initiate-dialogue)) (Goal Send-Greeting 1.0 1.0)))) 4)
        ((: r2 ((TTV 2 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Send-Greeting 0.9 0.6) elicit-response)) (Goal Receive-User-Response 1.0 1.0)))) 7)
        ((: r3a ((TTV 3 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Receive-User-Response 0.9 0.6) interpret-mood)) (Goal Understand-Initial-Mood 1.0 1.0)))) 8)
        ((: r3b ((TTV 3 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Receive-User-Response 0.9 0.6) interpret-context)) (Goal Understand-Initial-Context 1.0 1.0)))) 5)
        ((: r4 ((TTV 4 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Initial-Mood 0.9 0.6) probe-mood)) (Goal Explore-Mood-Details 1.0 1.0)))) 6)
        ((: r5 ((TTV 5 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Explore-Mood-Details 0.9 0.6) ask-activities)) (Goal Ask-Daily-Activities 1.0 1.0)))) 5)
        ((: r6 ((TTV 6 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Initial-Context 0.9 0.6) request-activities)) (Goal Ask-Daily-Activities 1.0 1.0)))) 3)
        ((: r7 ((TTV 7 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Ask-Daily-Activities 0.9 0.6) collect-activity-details)) (Goal Learn-Activity-Details 1.0 1.0)))) 2)
        ((: r8a ((TTV 8 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Activity-Details 0.9 0.6) explore-hobbies)) (Goal Understand-Hobby-Preferences 1.0 1.0)))) 9)
        ((: r8b ((TTV 8 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Activity-Details 0.9 0.6) explore-goals)) (Goal Understand-Future-Goals 1.0 1.0)))) 7)
        ((: r9 ((TTV 9 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Hobby-Preferences 0.9 0.6) query-aspirations)) (Goal Summarize-User-Preferences 1.0 1.0)))) 4)
        ((: r10 ((TTV 10 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Future-Goals 0.9 0.6) synthesize-preferences)) (Goal Summarize-User-Preferences 1.0 1.0)))) 6)
        ((: r11 ((TTV 11 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-User-Preferences 0.9 0.6) finalize-understanding)) (Goal Understand-User-Interests 1.0 1.0)))) 10)
        ((: d1 ((TTV 12 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Receive-User-Response 0.9 0.6) discuss-random-topic)) (Goal Off-Topic-Discussion 1.0 1.0)))) 10)
        ((: d2 ((TTV 13 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Initial-Mood 0.9 0.6) share-joke)) (Goal Engage-User-Fun 1.0 1.0)))) 9)
        ((: d3 ((TTV 14 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Ask-Daily-Activities 0.9 0.6) redirect-conversation)) (Goal Send-Greeting 1.0 1.0)))) 8)
        ((: d4 ((TTV 15 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Activity-Details 0.9 0.6) offer-advice)) (Goal Provide-Feedback 1.0 1.0)))) 10)
        ((: d5 ((TTV 16 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Hobby-Preferences 0.9 0.6) explore-unrelated-topics)) (Goal Off-Topic-Discussion 1.0 1.0)))) 7)
        ((: d6 ((TTV 17 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Future-Goals 0.9 0.6) ask-irrelevant-question)) (Goal Irrelevant-Topic 1.0 1.0)))) 9)
        ((: d7 ((TTV 18 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Explore-Mood-Details 0.9 0.6) share-story)) (Goal Engage-User-Story 1.0 1.0)))) 8)
        ((: r19 ((TTV 19 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-User-Interests 0.9 0.6) inquire-recent-events)) (Goal Ask-Recent-Events 1.0 1.0)))) 6)
        ((: r20 ((TTV 20 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Ask-Recent-Events 0.9 0.6) collect-event-details)) (Goal Learn-Recent-Event-Details 1.0 1.0)))) 5)
        ((: r21 ((TTV 21 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Recent-Event-Details 0.9 0.6) explore-event-impact)) (Goal Understand-Event-Impact 1.0 1.0)))) 8)
        ((: r22 ((TTV 22 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Event-Impact 0.9 0.6) probe-emotions)) (Goal Explore-Event-Emotions 1.0 1.0)))) 7)
        ((: r23 ((TTV 23 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Explore-Event-Emotions 0.9 0.6) assess-significance)) (Goal Understand-Event-Significance 1.0 1.0)))) 4)
        ((: r24 ((TTV 24 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Event-Significance 0.9 0.6) suggest-related-topics)) (Goal Propose-Related-Topics 1.0 1.0)))) 9)
        ((: r25 ((TTV 25 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Propose-Related-Topics 0.9 0.6) elicit-topic-choice)) (Goal Receive-Topic-Choice 1.0 1.0)))) 6)
        ((: r26 ((TTV 26 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Receive-Topic-Choice 0.9 0.6) explore-chosen-topic)) (Goal Discuss-Chosen-Topic 1.0 1.0)))) 5)
        ((: r27 ((TTV 27 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Discuss-Chosen-Topic 0.9 0.6) deepen-topic-discussion)) (Goal Deepen-Topic-Understanding 1.0 1.0)))) 8)
        ((: r28 ((TTV 28 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Deepen-Topic-Understanding 0.9 0.6) ask-specific-questions)) (Goal Learn-Specific-Topic-Details 1.0 1.0)))) 7)
        ((: r29 ((TTV 29 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Specific-Topic-Details 0.9 0.6) assess-topic-interest)) (Goal Evaluate-Topic-Interest 1.0 1.0)))) 4)
        ((: r30 ((TTV 30 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Evaluate-Topic-Interest 0.9 0.6) check-engagement)) (Goal Confirm-User-Engagement 1.0 1.0)))) 6)
        ((: r31 ((TTV 31 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-User-Engagement 0.9 0.6) low-engagement-detected)) (Goal Re-engage-User 1.0 1.0)))) 9)
        ((: r32 ((TTV 32 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Re-engage-User 0.9 0.6) suggest-new-topic)) (Goal Propose-New-Topic 1.0 1.0)))) 5)
        ((: r33 ((TTV 33 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Propose-New-Topic 0.9 0.6) elicit-new-topic-choice)) (Goal Receive-New-Topic-Choice 1.0 1.0)))) 7)
        ((: r34 ((TTV 34 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Receive-New-Topic-Choice 0.9 0.6) explore-new-topic)) (Goal Discuss-New-Topic 1.0 1.0)))) 8)
        ((: r35 ((TTV 35 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Discuss-New-Topic 0.9 0.6) ask-related-questions)) (Goal Learn-New-Topic-Details 1.0 1.0)))) 6)
        ((: r36 ((TTV 36 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-New-Topic-Details 0.9 0.6) assess-topic-relevance)) (Goal Evaluate-Topic-Relevance 1.0 1.0)))) 4)
        ((: r37 ((TTV 37 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Evaluate-Topic-Relevance 0.9 0.6) connect-to-preferences)) (Goal Relate-To-User-Preferences 1.0 1.0)))) 9)
        ((: r38 ((TTV 38 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Relate-To-User-Preferences 0.9 0.6) confirm-relevance)) (Goal Confirm-Topic-Relevance 1.0 1.0)))) 5)
        ((: r39 ((TTV 39 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Topic-Relevance 0.9 0.6) deepen-exploration)) (Goal Deepen-Topic-Exploration 1.0 1.0)))) 7)
        ((: r40 ((TTV 40 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Deepen-Topic-Exploration 0.9 0.6) ask-detailed-questions)) (Goal Learn-Detailed-Topic-Insights 1.0 1.0)))) 8)
        ((: r41 ((TTV 41 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Detailed-Topic-Insights 0.9 0.6) evaluate-insights)) (Goal Understand-Topic-Insights 1.0 1.0)))) 6)
        ((: r42 ((TTV 42 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Topic-Insights 0.9 0.6) summarize-insights)) (Goal Summarize-Topic-Insights 1.0 1.0)))) 4)
        ((: r43 ((TTV 43 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Topic-Insights 0.9 0.6) check-user-agreement)) (Goal Confirm-Insight-Accuracy 1.0 1.0)))) 9)
        ((: r44 ((TTV 44 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Insight-Accuracy 0.9 0.6) correct-misunderstandings)) (Goal Refine-Topic-Understanding 1.0 1.0)))) 5)
        ((: r45 ((TTV 45 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Topic-Understanding 0.9 0.6) explore-related-interests)) (Goal Identify-Related-Interests 1.0 1.0)))) 7)
        ((: r46 ((TTV 46 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-Related-Interests 0.9 0.6) ask-preference-questions)) (Goal Learn-Preference-Details 1.0 1.0)))) 8)
        ((: r47 ((TTV 47 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Preference-Details 0.9 0.6) evaluate-preference-strength)) (Goal Understand-Preference-Strength 1.0 1.0)))) 6)
        ((: r48 ((TTV 48 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Preference-Strength 0.9 0.6) explore-motivations)) (Goal Explore-Preference-Motivations 1.0 1.0)))) 4)
        ((: r49 ((TTV 49 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Explore-Preference-Motivations 0.9 0.6) summarize-preferences)) (Goal Summarize-Preference-Insights 1.0 1.0)))) 9)
        ((: r50 ((TTV 50 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Preference-Insights 0.9 0.6) check-user-feedback)) (Goal Receive-Preference-Feedback 1.0 1.0)))) 5)
        ; ((: r51 ((TTV 51 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Receive-Preference-Feedback 0.9 0.6) adjust-understanding)) (Goal Refine-Preference-Understanding 1.0 1.0)))) 7)
        ; ((: r52 ((TTV 52 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Preference-Understanding 0.9 0.6) explore-new-interests)) (Goal Identify-New-Interests 1.0 1.0)))) 8)
        ; ((: r53 ((TTV 53 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-New-Interests 0.9 0.6) ask-interest-questions)) (Goal Learn-New-Interest-Details 1.0 1.0)))) 6)
        ; ((: r54 ((TTV 54 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-New-Interest-Details 0.9 0.6) assess-interest-level)) (Goal Evaluate-Interest-Level 1.0 1.0)))) 4)
        ; ((: r55 ((TTV 55 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Evaluate-Interest-Level 0.9 0.6) explore-interest-reasons)) (Goal Understand-Interest-Reasons 1.0 1.0)))) 9)
        ; ((: r56 ((TTV 56 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Interest-Reasons 0.9 0.6) summarize-interest-insights)) (Goal Summarize-Interest-Insights 1.0 1.0)))) 5)
        ; ((: r57 ((TTV 57 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Interest-Insights 0.9 0.6) check-insight-accuracy)) (Goal Confirm-Interest-Accuracy 1.0 1.0)))) 7)
        ; ((: r58 ((TTV 58 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Interest-Accuracy 0.9 0.6) refine-insights)) (Goal Refine-Interest-Understanding 1.0 1.0)))) 8)
        ; ((: r59 ((TTV 59 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Interest-Understanding 0.9 0.6) explore-related-topics)) (Goal Identify-Related-Topics 1.0 1.0)))) 6)
        ; ((: r60 ((TTV 60 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-Related-Topics 0.9 0.6) propose-topic-exploration)) (Goal Propose-Topic-Exploration 1.0 1.0)))) 4)
        ; ((: r61 ((TTV 61 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Propose-Topic-Exploration 0.9 0.6) elicit-topic-preference)) (Goal Receive-Topic-Preference 1.0 1.0)))) 9)
        ; ((: r62 ((TTV 62 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Receive-Topic-Preference 0.9 0.6) discuss-preferred-topic)) (Goal Discuss-Preferred-Topic 1.0 1.0)))) 5)
        ; ((: r63 ((TTV 63 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Discuss-Preferred-Topic 0.9 0.6) deepen-topic-discussion)) (Goal Deepen-Preferred-Topic-Understanding 1.0 1.0)))) 7)
        ; ((: r64 ((TTV 64 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Deepen-Preferred-Topic-Understanding 0.9 0.6) ask-specific-questions)) (Goal Learn-Specific-Topic-Insights 1.0 1.0)))) 8)
        ; ((: r65 ((TTV 65 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Specific-Topic-Insights 0.9 0.6) evaluate-topic-insights)) (Goal Understand-Specific-Topic-Insights 1.0 1.0)))) 6)
        ; ((: r66 ((TTV 66 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Specific-Topic-Insights 0.9 0.6) summarize-topic-insights)) (Goal Summarize-Specific-Topic-Insights 1.0 1.0)))) 4)
        ; ((: r67 ((TTV 67 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Specific-Topic-Insights 0.9 0.6) check-user-agreement)) (Goal Confirm-Specific-Topic-Accuracy 1.0 1.0)))) 9)
        ; ((: r68 ((TTV 68 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Specific-Topic-Accuracy 0.9 0.6) refine-topic-understanding)) (Goal Refine-Specific-Topic-Understanding 1.0 1.0)))) 5)
        ; ((: r69 ((TTV 69 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Specific-Topic-Understanding 0.9 0.6) explore-user-goals)) (Goal Identify-User-Goals 1.0 1.0)))) 7)
        ; ((: r70 ((TTV 70 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-User-Goals 0.9 0.6) ask-goal-questions)) (Goal Learn-Goal-Details 1.0 1.0)))) 8)
        ; ((: r71 ((TTV 71 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Goal-Details 0.9 0.6) assess-goal-importance)) (Goal Understand-Goal-Importance 1.0 1.0)))) 6)
        ; ((: r72 ((TTV 72 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Goal-Importance 0.9 0.6) explore-goal-motivations)) (Goal Explore-Goal-Motivations 1.0 1.0)))) 4)
        ; ((: r73 ((TTV 73 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Explore-Goal-Motivations 0.9 0.6) summarize-goals)) (Goal Summarize-Goal-Insights 1.0 1.0)))) 9)
        ; ((: r74 ((TTV 74 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Goal-Insights 0.9 0.6) check-goal-accuracy)) (Goal Confirm-Goal-Accuracy 1.0 1.0)))) 5)
        ; ((: r75 ((TTV 75 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Goal-Accuracy 0.9 0.6) refine-goal-understanding)) (Goal Refine-Goal-Understanding 1.0 1.0)))) 7)
        ; ((: r76 ((TTV 76 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Goal-Understanding 0.9 0.6) explore-related-goals)) (Goal Identify-Related-Goals 1.0 1.0)))) 8)
        ; ((: r77 ((TTV 77 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-Related-Goals 0.9 0.6) ask-related-goal-questions)) (Goal Learn-Related-Goal-Details 1.0 1.0)))) 6)
        ; ((: r78 ((TTV 78 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Related-Goal-Details 0.9 0.6) assess-goal-relevance)) (Goal Understand-Related-Goal-Relevance 1.0 1.0)))) 4)
        ; ((: r79 ((TTV 79 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Related-Goal-Relevance 0.9 0.6) summarize-related-goals)) (Goal Summarize-Related-Goal-Insights 1.0 1.0)))) 9)
        ; ((: r80 ((TTV 80 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Related-Goal-Insights 0.9 0.6) check-goal-feedback)) (Goal Confirm-Related-Goal-Accuracy 1.0 1.0)))) 5)
;        ; ((: r81 ((TTV 81 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Related-Goal-Accuracy 0.9 0.6) refine-goal-insights)) (Goal Refine-Related-Goal-Understanding 1.0 1.0)))) 7)
;        ; ((: r82 ((TTV 82 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Related-Goal-Understanding 0.9 0.6) explore-user-values)) (Goal Identify-User-Values 1.0 1.0)))) 8)
;        ; ((: r83 ((TTV 83 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-User-Values 0.9 0.6) ask-value-questions)) (Goal Learn-Value-Details 1.0 1.0)))) 6)
;        ; ((: r84 ((TTV 84 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Value-Details 0.9 0.6) assess-value-importance)) (Goal Understand-Value-Importance 1.0 1.0)))) 4)
;        ; ((: r85 ((TTV 85 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Value-Importance 0.9 0.6) explore-value-motivations)) (Goal Explore-Value-Motivations 1.0 1.0)))) 9)
;        ; ((: r86 ((TTV 86 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Explore-Value-Motivations 0.9 0.6) summarize-values)) (Goal Summarize-Value-Insights 1.0 1.0)))) 5)
;        ; ((: r87 ((TTV 87 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Value-Insights 0.9 0.6) check-value-accuracy)) (Goal Confirm-Value-Accuracy 1.0 1.0)))) 7)
;        ; ((: r88 ((TTV 88 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Value-Accuracy 0.9 0.6) refine-value-understanding)) (Goal Refine-Value-Understanding 1.0 1.0)))) 8)
;        ; ((: r89 ((TTV 89 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Value-Understanding 0.9 0.6) explore-related-values)) (Goal Identify-Related-Values 1.0 1.0)))) 6)
;        ; ((: r90 ((TTV 90 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-Related-Values 0.9 0.6) ask-related-value-questions)) (Goal Learn-Related-Value-Details 1.0 1.0)))) 4)
;        ; ((: r91 ((TTV 91 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Related-Value-Details 0.9 0.6) assess-value-relevance)) (Goal Understand-Related-Value-Relevance 1.0 1.0)))) 9)
;        ; ((: r92 ((TTV 92 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Related-Value-Relevance 0.9 0.6) summarize-related-values)) (Goal Summarize-Related-Value-Insights 1.0 1.0)))) 5)
;        ; ((: r93 ((TTV 93 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Related-Value-Insights 0.9 0.6) check-value-feedback)) (Goal Confirm-Related-Value-Accuracy 1.0 1.0)))) 7)
;        ; ((: r94 ((TTV 94 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Related-Value-Accuracy 0.9 0.6) refine-value-insights)) (Goal Refine-Related-Value-Understanding 1.0 1.0)))) 8)
;        ; ((: r95 ((TTV 95 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Related-Value-Understanding 0.9 0.6) explore-user-challenges)) (Goal Identify-User-Challenges 1.0 1.0)))) 6)
;        ; ((: r96 ((TTV 96 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-User-Challenges 0.9 0.6) ask-challenge-questions)) (Goal Learn-Challenge-Details 1.0 1.0)))) 4)
;        ; ((: r97 ((TTV 97 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Learn-Challenge-Details 0.9 0.6) assess-challenge-impact)) (Goal Understand-Challenge-Impact 1.0 1.0)))) 9)
;        ; ((: r98 ((TTV 98 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Challenge-Impact 0.9 0.6) explore-challenge-reasons)) (Goal Explore-Challenge-Reasons 1.0 1.0)))) 5)
;        ; ((: r99 ((TTV 99 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Explore-Challenge-Reasons 0.9 0.6) summarize-challenges)) (Goal Summarize-Challenge-Insights 1.0 1.0)))) 7)
;        ; ((: r100 ((TTV 100 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Challenge-Insights 0.9 0.6) check-challenge-accuracy)) (Goal Confirm-Challenge-Accuracy 1.0 1.0)))) 8)
;        ; ((: r101 ((TTV 101 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Challenge-Accuracy 0.9 0.6) refine-challenge-understanding)) (Goal Refine-Challenge-Understanding 1.0 1.0)))) 6)
;        ; ((: r102 ((TTV 102 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Challenge-Understanding 0.9 0.6) explore-solutions)) (Goal Identify-Potential-Solutions 1.0 1.0)))) 4)
;        ; ((: r103 ((TTV 103 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Identify-Potential-Solutions 0.9 0.6) discuss-solutions)) (Goal Discuss-Potential-Solutions 1.0 1.0)))) 9)
;        ; ((: r104 ((TTV 104 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Discuss-Potential-Solutions 0.9 0.6) assess-solution-feasibility)) (Goal Evaluate-Solution-Feasibility 1.0 1.0)))) 5)
;        ; ((: r105 ((TTV 105 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Evaluate-Solution-Feasibility 0.9 0.6) refine-solutions)) (Goal Refine-Solution-Options 1.0 1.0)))) 7)
;        ; ((: r106 ((TTV 106 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Refine-Solution-Options 0.9 0.6) summarize-solutions)) (Goal Summarize-Solution-Insights 1.0 1.0)))) 8)
;        ; ((: r107 ((TTV 107 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Summarize-Solution-Insights 0.9 0.6) check-solution-accuracy)) (Goal Confirm-Solution-Accuracy 1.0 1.0)))) 6)
;        ; ((: r108 ((TTV 108 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Confirm-Solution-Accuracy 0.9 0.6) explore-user-preferences)) (Goal Understand-Solution-Preferences 1.0 1.0)))) 4)
;        ; ((: r109 ((TTV 109 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Understand-Solution-Preferences 0.9 0.6) finalize-solutions)) (Goal Finalize-Solution-Recommendations 1.0 1.0)))) 9)
;        ; ((: r110 ((TTV 110 (STV 0.8 0.7)) (IMPLICATION_LINK (AND_LINK ((Goal Finalize-Solution-Recommendations 0.9 0.6) check-user-satisfaction)) (Goal Confirm-User-Satisfaction 1.0 1.0)))) 5)
        )
      )
      (add-atom $space $rules)
    )

)

;;gets weights from rule
(= (getWeightFromRule $rule)
    (let ($schema $weight) $rule $weight)
)
;; The below function extracts an action from a cognitive schema.
;; The input will be a scalar weighted rule and returns an action. 
(= (selectActionFromRule $rule)
    (let* (
        (($schema $weight) $rule)
        ($schema (: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ($context $action)) $goal))))
    )
        $action
    )
)
;; select single action from available rules. 
(= (selectSingleActionHelper $space $rulesWithWeight $minValue $currAction $targetValue)
    (if (== $rulesWithWeight ())
        (let $handleWithAction (findRulesWithAction $space $currAction) ;; a temporary solution
            ((car-atom $handleWithAction) $currAction)

        )
        (let* (
            ($currRule (car-atom $rulesWithWeight))
            ($tail (cdr-atom $rulesWithWeight))
            ($weight (getWeightFromRule $currRule))
            ($ruleAction (selectActionFromRule $currRule))
            ($range (- $targetValue $weight))
        )
            (if (< $range (- $targetValue $minValue))
                (selectSingleActionHelper $space $tail $weight $ruleAction $targetValue)
                (selectSingleActionHelper $space $tail $minValue $currAction $targetValue)
            )
        )

    )
    
)

;; This functions selects a single action from a list of rules
;; That are going to be implemented in relation to a target value.
(= (selectSingleAction $space $rulesWithWeight $targetValue)
    (if (or (== $rulesWithWeight ()) (== $rulesWithWeight (())))
        (() ())
        (let* (
            ($head (car-atom $rulesWithWeight))
            ($action (selectActionFromRule $head))
            ($weight (getWeightFromRule $head))
        )
            (selectSingleActionHelper $space $rulesWithWeight $weight $action $targetValue)
        )
    )
)

;; This function might require further modification later.
(= (findRulesWithContext $space $context)
    (collapse (match $space ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ((Goal $context $x $y) $action)) $goal))) $weight)
        ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ((Goal $context $x $y) $action)) $goal))) $weight) 
    ))

)
;; finds rules with goals as contexts
(= (findRulesWithGoalAsContext $space $goal)
    (collapse (match $space ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ((Goal $goal $x $y) $action)) $nextGoal))) $weight)
        ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ((Goal $goal $x $y) $action)) $nextGoal))) $weight) 
    ))

)
;; finds rules with similar actions
(= (findRulesWithAction $space $action)
    (collapse (match $space ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ($context $action)) $goal))) $weight)
        ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ($context $action)) $goal))) $weight)
        
    ))

)
;; This function fetches rules for multiple goals given as an s-expression. 
(= (findRulesForMultipleGoals $space $goals $accum)
    (if (== $goals ())
        $accum
        (let* (
            (($head $tail) (decons-atom $goals))
            ($goalName (extractGoalName $head))
            ($rules (findRulesWithGoalAsContext $space $goalName))
            ($newAccum (union-atom $accum $rules))
        )  
            (findRulesForMultipleGoals $space $tail $newAccum)
        )
    )
)
;; filters rules with the same goal name.
(= (findRulesWithGoal $space $goal)
    (collapse (match $space ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ($context $action)) (Goal $goal $x $y)))) $weight)
        ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ($context $action)) (Goal $goal $x $y)))) $weight)
        
    ))
)

(= (getDgv $goal)
    (let (Goal $name $x $y) $goal $y)
)

(= (extractGoalName $goal)
    (let (Goal $name $x $y) $goal $name)
)

(= (extractGoalFromRule $rule)
    (let ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ($context $action)) $goal))) $weight) $rule $goal)

)

(= (extractContextFromRule $rule)
    (let ((: $handle ((TTV $time (STV $bel $conf)) (IMPLICATION_LINK (AND_LINK ($context $action)) $goal))) $weight) $rule $context)
)
;; an implementation inspired that greedily selects 
;; an action at each step.
(= (planner' $ruleSpace $initState $goal $target $accum)
    (if (== $initState $goal)
        $accum
        (let* (
            ($relatedRules (findRulesWithContext $ruleSpace $initState))
            ;($_ (println! (relatedRules $relatedRules)))
            (($rule $currAction) (selectSingleAction $ruleSpace $relatedRules $target))
            ;($_ (println! (rule $rule action $currAction)))
            ($accum' (if (== $currAction ()) $accum (union-atom $accum ($currAction))))
            ($goals (collapse (extractGoalFromRule (superpose $relatedRules))))
            ($nextRules (findRulesForMultipleGoals $ruleSpace $goals ()))
            ;($_ (println! (goals $goals nextRules $nextRules)))
            (($currRule $action) (selectSingleAction $ruleSpace $nextRules $target))
            ;($_ (println! (currRule $currRule action $action)))
            
        )
            (if (== $action ())
                $accum'
                (let* (
                    ($newAccum (union-atom $accum' ($action))) ;; accumulating actions in the action accumulator.
                    ($newState (extractGoalFromRule $currRule))
                    ($stateName (extractGoalName $newState))         
                )
                    (planner' $ruleSpace $stateName $goal $target $newAccum)
                )
            )

        )        
    )
)

;; The main planner function that starts the planning process.
;; It initializes the planning by finding rules related to the goal
;; and then calls the recursive planner function.
(= (planner $ruleSpace $initState $goal)
    (let* (
        
        ($targetRules (findRulesWithGoal $ruleSpace $goal))
        ;($_ (println! (targetRules $targetRules)))
        ($targetRules (if (== $targetRules ()) (()) $targetRules))
        ($targetRule (car-atom $targetRules))
        ($target (getWeightFromRule $targetRule))
        ; ($_ (println! (targetRules $targetRules target $target)))
        
    )
        (planner' $ruleSpace $initState $goal $target ())

    )
)

;!(addRulesToSpace &ruleSpace )
;;;!(get-atoms &ruleSpace)
;!(planner &ruleSpace Conversation-Started Receive-User-Response)

;;!(findRulesWithGoal &ruleSpace Receive-User-Response) 
